<!DOCTYPE html>
<html lang="ru">
<head>
    <title>360° Image Browser</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <!--animation component script-->
    <script src="https://unpkg.com/aframe-animation-component@^4.1.2/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.5.1/dist/aframe-look-at-component.min.js"></script>
    <script>
        AFRAME.registerComponent("menubutton", {
            events: {
                mouseenter: function() {
                    this.el.setAttribute("scale", "0 0 0");
                    document.querySelector("#menu").setAttribute("scale", "1 1 1");
                }
            }
        });

        AFRAME.registerComponent("hotspots", {
            init: function() {
                this.el.addEventListener("reloadspots", function(evt) {
                    //get the entire current spot group and scale it to 0
                    var currspotgroup = document.getElementById(evt.detail.currspots);
                    currspotgroup.setAttribute("scale", "0 0 0");

                    //get the entire new spot group and scale it to 1
                    var newspotgroup = document.getElementById(evt.detail.newspots);
                    newspotgroup.setAttribute("scale", "1 1 1");
                });
            }
        });

        AFRAME.registerComponent("spot", {
            schema: {
                linkto: { type: "string", default: "" },
                spotgroup: { type: "string", default: "" }
            },
            init: function() {
                //add image source of hotspot icon
                this.el.setAttribute("src", "#hotspot");
                //make the icon look at the camera all the time
                this.el.setAttribute("look-at", "#camera");

                var data = this.data;

                this.el.addEventListener("click", function() {
                    //set the skybox source to the new image as per the spot
                    var sky = document.getElementById("skybox");
                    sky.setAttribute("src", data.linkto);

                    var spotcomp = document.getElementById("spots");
                    var currspots = this.parentElement.getAttribute("id");
                    //create event for spots component to change the spots data
                    spotcomp.emit("reloadspots", {
                        newspots: data.spotgroup,
                        currspots: currspots
                    });
                });
            }
        });

        AFRAME.registerComponent("campus-options", {
            mouseenter: function(e) {

            }
        });
    </script>
</head>
<body>
<a-scene>
    <a-assets>
        <a-mixin
                id="text"
                text="align: center; width: 6"
                material="color: #EC0B43"
        ></a-mixin>

        <a-mixin
                id="button"
                geometry="primitive: plane; width: 1; height: 0.35"
                material="color: white"
        ></a-mixin>
        <audio
                id="click-sound"
                src="https://cdn.aframe.io/360-image-gallery-boilerplate/audio/click.ogg"
        ></audio>

        <audio
                id="hover-sound"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fhover.ogg?v=1585432296309"
        ></audio>

        <!-- Images. -->
        <img
                id="main-entrance"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fphoto1.jpg?v=1584288748117"
        />

        <img
                id="main-entrance__point2"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fphoto2.jpg?v=1585343746234"
        />

        <img
                id="dining-room"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fphoto3.jpg?v=1585344157905"
        />

        <img
                id="gym"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fphoto4.jpg?v=1585343763400"
        />

        <img
                id="hotspot"
                width="100"
                height="100"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fhotspot.png?v=1585349082486"
        />

        <img
                id="close-icon"
                color="white"
                width="1000"
                height="1000"
                src="https://cdn.glitch.com/ecc1f35c-4fe9-4706-9469-d40abe5241ac%2Fcancel-black-18dp%20(1).svg?v=1585511681184"
        />
    </a-assets>

    <a-entity id="spots" hotspots>
        <a-entity id="group-point1">
            <a-image
                    spot="linkto:#main-entrance__point2;spotgroup:group-point2"
                    position="2.5 -2 -9"
            ></a-image>
        </a-entity>
        <a-entity id="group-point2" scale="0 0 0">
            <a-image
                    spot="linkto:#main-entrance;spotgroup:group-point2"
                    position="2.5 -2 -9"
            ></a-image>
        </a-entity>
    </a-entity>

    <a-sky id="skybox" radius="10" src="#main-entrance"></a-sky>

    <!--Кнопка Меню-->
    <a-entity
            look-at
            menubutton
            id="menu-button"
            geometry="primitive: plane; width: 1; height: 0.35"
            render-order="menu"
            depth="1"
            position="0 -3 -3"
            material="color: red"
            src="#menu"
    >
        <a-text id="menu-button-label" value="меню2" position="-0.3 0 1">
        </a-text>

        <a-entity
                text="font: https://cdn.aframe.io/fonts/mozillavr.fnt; value: Via URL."
        ></a-entity>
    </a-entity>

    <!--Меню-->
    <a-entity
            scale="1 1 1"
            id="menu"
            position="0 -3 -2"
            depth="2"
            material="color: #808080; opacity: 0.9"
            geometry="primitive: plane; width: 3; height: 2.4"
    >
        <a-image id="close" src="#close-icon" color="white" position="1.2 1 0"></a-image>

        <a-entity id="campus">
            <a-text
                    id="campus-label"
                    mixin="text"
                    value="Campus"
                    position="-1 0.9 0"
                    wrap-count="30"
                    color="black"
            ></a-text>
            <a-entity campus-options id="campus-options" position="-0.7 0 0">
                <a-entity
                        id="campus1"
                        mixin="button"
                        radius="5"
                        position="0 0.5 0.1"
                >
                    <a-text
                            value="Main Campus"
                            mixin="text"
                            position="0 0 0"
                            wrap-count="80"
                            color="#EC0B43"
                    ></a-text>
                </a-entity>

                <a-entity id="campus2" mixin="button" radius="5" position="0 0 0.1">
                    <a-text
                            value="Campus2"
                            mixin="text"
                            position="0 0 0"
                            wrap-count="80"
                            color="#EC0B43"
                    ></a-text>
                </a-entity>

                <a-entity
                        id="campus3"
                        mixin="button"
                        radius="5"
                        position="0 -0.5 0.1"
                >
                    <a-text
                            value="Campus3"
                            mixin="text"
                            position="0 0 0"
                            wrap-count="80"
                            color="#EC0B43"
                    ></a-text>
                </a-entity>
            </a-entity>
        </a-entity>

        <a-entity id="room">
            <a-text
                    id="room-label"
                    mixin="text"
                    value="Room"
                    position="1 0.9 0"
                    wrap-count="30"
                    color="black"
            ></a-text>
            <a-entity id="room-options" position="0.7 0 0" visible>
                <a-entity id="room1" mixin="button" radius="5" position="0 0.5 0.1">
                    <a-text
                            value="Room1"
                            mixin="text"
                            position="0 0 0"
                            wrap-count="80"
                            color="#EC0B43"
                    ></a-text>
                </a-entity>

                <a-entity id="room2" mixin="button" radius="5" position="0 0 0.1">
                    <a-text
                            value="Room2"
                            mixin="text"
                            position="0 0 0"
                            wrap-count="80"
                            color="#EC0B43"
                    ></a-text>
                </a-entity>

                <a-entity
                        id="room3"
                        mixin="button"
                        radius="5"
                        position="0 -0.5 0.1"
                >
                    <a-text
                            value="Room3"
                            mixin="text"
                            position="0 0 0"
                            wrap-count="80"
                            color="#EC0B43"
                    ></a-text>
                </a-entity>
            </a-entity>
        </a-entity>
    </a-entity>

    <!--Камера-->
    <!--       <a-entity id="camera" camera position="0 -3 0" look-controls>
      <a-entity
        cursor="fuse:true;fuseTimeout:2000"
        geometry="primitive:ring;radiusInner:0.01;radiusOuter:0.02"
        position="0 0 -1.8"
        animation__mouseenter="property:scale;to:3 3 3;startEvents:mouseenter;endEvents:mouseleave;dir:reverse;dur:2000;loop:1"
      >
      </a-entity>
    </a-entity> -->

    <!-- Camera + Cursor. -->
    <a-camera position="0 -3 0" look-controls>
        <a-cursor
                id="cursor"
                animation__click="property: scale; from: 0.1 0.1 0.1; to: 1 1 1; easing: easeInCubic; dur: 150; startEvents: click"
                animation__clickreset="property: scale; to: 0.1 0.1 0.1; dur: 1; startEvents: animationcomplete__click"
                animation__fusing="property: scale; from: 1 1 1; to: 0.1 0.1 0.1; easing: easeInCubic; dur: 150; startEvents: fusing"
        ></a-cursor>
    </a-camera>
</a-scene>
</body>

</html>
